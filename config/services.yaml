# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
    app.env: '%env(APP_ENV)%'
    app.domain: '%env(APP_DOMAIN)%'
    app.scheme: '%env(APP_SCHEME)%'

    kafka.global:
        group.id: '%env(string:RD_KAFKA_GROUP_ID)%'
        metadata.broker.list: '%env(string:RD_KAFKA_BROKER_LIST)%'
        enable.auto.commit: 'false'
    kafka.topic:
        auto.offset.reset: beginning

imports:
    - { resource: application/*/*.yaml }
    - { resource: application/*.yaml }
    - { resource: domain/*.yaml }
    - { resource: infrastructure/*/*.yaml }
    - { resource: infrastructure/*.yaml }
    - { resource: presentation/*.yaml }
    - { resource: test/*/*.yaml }

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Kernel.php'

    App\User\Domain\Repository\UserRepositoryInterface:
        class: App\User\Infrastructure\Repository\UserRepository

    App\Role\Domain\Repository\RoleRepositoryInterface:
        class: App\Role\Infrastructure\Repository\RoleRepository

    App\Common\Domain\Message\MessageBusInterface:
        class: App\Common\Application\Message\MessageBus

    # Dependency Injection Dtos
    App\Common\Infrastructure\DI\Config\KafkaConfig:
        arguments:
            $globalConfig: '%kafka.global%'
            $topicConfig: '%kafka.topic%'


    Interop\Queue\ConnectionFactory:
        class: Enqueue\RdKafka\RdKafkaConnectionFactory
        arguments:
            $config:
                global: '%kafka.global%'
                topic: '%kafka.topic%'

    Symfony\Component\Uid\AbstractUid:
        class: Symfony\Component\Uid\UuidV4

    # add more service definitions when explicit configuration is needed
    # please note that last definitions always *replace* previous ones
